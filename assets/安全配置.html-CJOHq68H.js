import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as n,o as e}from"./app-Cl510U7u.js";const l={};function t(p,s){return e(),a("div",null,s[0]||(s[0]=[n(`<p>本项目推荐是局域网使用，若您需要做到公网环境，为了确保安全，您必须按照以下方式进行配置</p><h2 id="一、安装反向代理" tabindex="-1"><a class="header-anchor" href="#一、安装反向代理"><span>一、安装反向代理</span></a></h2><p>您可以使用任何支持反向代理的软件，推荐Docker可以在1panel中安装<code>OpenResty</code>，并配置反向代理。</p><h2 id="二、配置反向代理" tabindex="-1"><a class="header-anchor" href="#二、配置反向代理"><span>二、配置反向代理</span></a></h2><p>修改反向代理站点配置文件 添加以下内容</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    location /api/ {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 检查自定义请求头</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        if ($http_替换为你的自定义请求头 != &quot;替换你的密码&quot;) {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            return 403;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 转发到后端服务 端口若有更改请自行修改</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_pass http://localhost:3001;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header Host $host;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 可选</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    location /api/docs {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 公开访问，不检查API密钥 端口若有更改请自行修改</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_pass http://localhost:3001;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header Host $host;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完整内容</p><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yml"><span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">server {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    listen 80 ;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    server_name 47.239.194.151;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    index index.php index.html index.htm default.php default.htm default.html;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    proxy_set_header Host $host;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    proxy_set_header X-Forwarded-Host $server_name;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    proxy_set_header X-Real-IP $remote_addr;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    proxy_http_version 1.1;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    proxy_set_header Upgrade $http_upgrade;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    proxy_set_header Connection $http_connection;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    access_log /www/sites/47.239.194.151/log/access.log main;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    error_log /www/sites/47.239.194.151/log/error.log;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    location ^~ /.well-known/acme-challenge {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        allow all;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        root /usr/share/nginx/html;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    location /api/ {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 检查自定义请求头</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        if ($http_x_api_key != &quot;123123&quot;) {</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">            return 403;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 转发到后端服务</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_pass http://localhost:3001;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header Host $host;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    location /api/docs {</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        # 公开访问，不检查API密钥</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_pass http://localhost:3001;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header Host $host;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        proxy_set_header X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    include /www/sites/47.239.194.151/proxy/*.conf;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三、验证更改" tabindex="-1"><a class="header-anchor" href="#三、验证更改"><span>三、验证更改</span></a></h2><p>您现在可以访问反代后的端口，正常来讲，您应当会出现上传内容失败。需要在<code>设置</code>页面中填写<code>安全配置</code>与上面配置反向代理一样然后点击保存然后刷新您应当就可以正常上传内容。当然您可能还会遇到以下问题</p><details class="hint-container details"><summary>显示已连接但是上传失败</summary><ul><li>已连接使用的是独立websocket的连接，区别于普通请求是由服务端直接验证，所以您配置完毕后前端网页会正确添加您写的内容附加在ws建立的请求的头上，您可以从控制台中看到服务端输出日志。</li><li>上传内容等其它操作采用的是普通http请求，这时由您的反向代理负责验证，但是您可能错误的配置了请求头或反向代理的站点配置文件导致验证不通过</li></ul></details><h2 id="四、设置docker端口" tabindex="-1"><a class="header-anchor" href="#四、设置docker端口"><span>四、设置Docker端口</span></a></h2><div class="hint-container caution"><p class="hint-container-title">警告</p><p>此步骤您必须确保第三步设置完毕后没有任何问题再进行下面操作</p></div><p>上面的方法我们成功实现了验证，接下来最重要的步骤是一定要将http请求的端口（默认3001）关闭对外访问，您可以通过多种方式关闭</p><ol><li>若您有防火墙，您可以直接防火墙规则中设置拒绝</li><li>若您是内网穿透，您可以修改或删除此穿透的端口</li></ol><p>若您无法满足上述条件，您需要在Docker中在端口映射中，将此端口对应宿主机端口前面加上<code>127.0.0.1:3001</code>这将表示此端口将不允许从外部连入。</p>`,16)]))}const h=i(l,[["render",t]]),k=JSON.parse('{"path":"/%E9%83%A8%E7%BD%B2/%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE.html","title":"安全配置","lang":"zh-CN","frontmatter":{"title":"安全配置","icon":"fas fa-shield-alt","order":4,"description":"本项目推荐是局域网使用，若您需要做到公网环境，为了确保安全，您必须按照以下方式进行配置 一、安装反向代理 您可以使用任何支持反向代理的软件，推荐Docker可以在1panel中安装OpenResty，并配置反向代理。 二、配置反向代理 修改反向代理站点配置文件 添加以下内容 完整内容 三、验证更改 您现在可以访问反代后的端口，正常来讲，您应当会出现上传...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"安全配置\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-08-13T05:29:11.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yxsj245\\",\\"url\\":\\"https://www.xiaozhuhouses.asia/\\"}]}"],["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/%E9%83%A8%E7%BD%B2/%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE.html"}],["meta",{"property":"og:site_name","content":"剪切板同步服务"}],["meta",{"property":"og:title","content":"安全配置"}],["meta",{"property":"og:description","content":"本项目推荐是局域网使用，若您需要做到公网环境，为了确保安全，您必须按照以下方式进行配置 一、安装反向代理 您可以使用任何支持反向代理的软件，推荐Docker可以在1panel中安装OpenResty，并配置反向代理。 二、配置反向代理 修改反向代理站点配置文件 添加以下内容 完整内容 三、验证更改 您现在可以访问反代后的端口，正常来讲，您应当会出现上传..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-08-13T05:29:11.000Z"}],["meta",{"property":"article:modified_time","content":"2025-08-13T05:29:11.000Z"}]]},"git":{"createdTime":1755062951000,"updatedTime":1755062951000,"contributors":[{"name":"小朱","username":"","email":"10714957+xiao-zhu245@user.noreply.gitee.com","commits":1}]},"readingTime":{"minutes":2.71,"words":813},"filePathRelative":"部署/安全配置.md","autoDesc":true}');export{h as comp,k as data};
